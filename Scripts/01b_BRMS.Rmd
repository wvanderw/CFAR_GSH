---
title: "01b_BRMS"
author: "Wade VanderWright"
date: '2022-03-24'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###01_a -- PGLS Models for Ch. 1
## VanderWright, WJ
## May 27, 2022

## Model 1 - CFAR ~ GSH

```{r}
brms_1_prior <- get_prior(Log10CFAR_centered ~ Log10MeanGSH_centered,
                    data = GSH_df_pgls,
                    family = gaussian())


brms_1 <- brm(Log10CFAR_centered ~ Log10MeanGSH_centered,
                    data = GSH_df_pgls,
                    family = gaussian(),
                    prior = brms_1_prior,
                    warmup = 1000, iter = 5000,
                    cores = 4
                    )

summary(brms_1)
```

```{r}
plot(conditional_effects(brms_1), points = TRUE)

```

## Model 2 - CFAR ~ GSH * Max Size
```{r}
brms_2_prior <- get_prior(Log10CFAR_centered ~ Log10MeanGSH_centered * Log10MaxSize_centered,
                    data = GSH_df_pgls,
                    family = gaussian())

brms_2 <- brm(Log10CFAR_centered ~ Log10MeanGSH_centered * Log10MaxSize_centered,
                    data = GSH_df_pgls,
                    family = gaussian(),
                    prior = brms_2_prior,
                    warmup = 1000, iter = 5000,
                    cores = 4
                    )

summary(brms_2)

```


```{r}
plot(conditional_effects(brms_2), points = TRUE) #hit enter in the console

```

## Model 3 - CFAR ~ GSH + Max Size (No interaction)
```{r}
brms_3_prior <- get_prior(Log10CFAR_centered ~ Log10MeanGSH_centered + Log10MaxSize_centered,
                    data = GSH_df_pgls,
                    family = gaussian())

brms_3 <- brm(Log10CFAR_centered ~ Log10MeanGSH_centered + Log10MaxSize_centered,
                    data = GSH_df_pgls,
                    family = gaussian(),
                    prior = brms_3_prior,
                    warmup = 1000, iter = 5000,
                    cores = 4)

summary(brms_3)
```

```{r}
plot(conditional_effects(brms_3), points = TRUE) #hit enter in the console



```

## Model 4 - CFAR ~ GSH + PrimaryHabitat (No interaction)
```{r}
brms_4_prior <- get_prior(Log10CFAR_centered ~ Log10MeanGSH_centered + PrimaryHabitat,
                    data = GSH_df_pgls,
                    family = gaussian())

#run time was about 30 minutes
brms_4 <- brm(Log10CFAR_centered ~ Log10MeanGSH_centered + PrimaryHabitat,
                    data = GSH_df_pgls,
                    family = gaussian(),
                    prior = brms_4_prior,
                    cores = 4, warmup = 1000,
                    iter = 5000)

summary(brms_4)


```


```{r}
plot(conditional_effects(brms_4), points = TRUE)

```

```{r}
plot(brms_4, N=2, ask = F)
```


## Model 5 - CFAR ~ GSH * PrimaryHabitat
```{r}
brms_5_prior <- get_prior(Log10CFAR_centered ~ Log10MeanGSH_centered * PrimaryHabitat,
                    data = GSH_df_pgls,
                    family = gaussian())

#run time was about 30 minutes
brms_5 <- brm(Log10CFAR_centered ~ Log10MeanGSH_centered * PrimaryHabitat,
                    data = GSH_df_pgls,
                    family = gaussian(),
                    prior = brms_5_prior,
                    warmup = 1000, iter = 5000,
                    cores = 4)

summary(brms_5)


```


```{r}
plot(conditional_effects(brms_5), points = TRUE, ask = F)
```

```{r}
plot(brms_5, N=2, ask = F)

```



## Model 6 - CFAR ~ GSH + Phylogeny
```{r}
brms_6_prior <- get_prior(Log10CFAR_centered ~ Log10MeanGSH_centered + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B))

#run time was about 30 minutes
brms_6 <- brm(Log10CFAR_centered ~ Log10MeanGSH_centered + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B),
                    prior = brms_6_prior,
                    cores = 4,
                    warmup = 1000, iter = 5000)

summary(brms_6)


```


```{r}
plot(conditional_effects(brms_6), points = TRUE)

```

```{r}
plot(brms_6, N=2, ask = F)

```


```{r}
#lamda estimate
hyp <- "sd_Binomial__Intercept^2 / (sd_Binomial__Intercept^2 + sigma^2) = 0"
(hyp <- hypothesis(brms_6, hyp, class = NULL))
```

```{r}
plot(hyp)
```

## Model 7 - CFAR ~ GSH * Max Size + Phylogeny
```{r}
brms_7_prior <- get_prior(Log10CFAR_centered ~ Log10MeanGSH_centered * Log10MaxSize_centered + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B))

brms_7 <- brm(Log10CFAR_centered ~ Log10MeanGSH_centered * Log10MaxSize_centered + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B),
                    prior = brms_7_prior,
                    chains = 4, cores = 4,
                    warmup = 1000, iter = 5000)

summary(brms_7)
```


```{r}
plot(conditional_effects(brms_7), points = TRUE, ask = F) 

```


```{r}
plot(brms_7, N=2, ask = F)
```

```{r}
hyp <- 'sd_Binomial__Intercept^2 / (sd_Binomial__Intercept^2 + sigma^2) = 0'
(hyp <- hypothesis(brms_7, hyp, class = NULL))
```

```{r}
plot(hyp)
```

## Model 8 - CFAR ~ GSH + Max Size + Phylogeny
```{r}
brms_8_prior <- get_prior(Log10CFAR_centered ~ Log10MeanGSH_centered + Log10MaxSize_centered + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B))

brms_8 <- brm(Log10CFAR_centered ~ Log10MeanGSH_centered + Log10MaxSize_centered + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B),
                    prior = brms_8_prior,
                    chains = 4, cores = 4,
                    warmup = 1000, iter = 5000)

summary(brms_8)
```

```{r}
plot(conditional_effects(brms_8), points = TRUE, ask = F)
```

```{r}
hyp <- 'sd_Binomial__Intercept^2 / (sd_Binomial__Intercept^2 + sigma^2) = 0'
(hyp <- hypothesis(brms_8, hyp, class = NULL))
plot(hyp)
```


## Model 9 - CFAR ~ GSH + PrimaryHabitat + Phylogeny
```{r}
HabitatPhylo_prior <- get_prior(Log10CFAR ~ Log10MeanGSH_centered + PrimaryHabitat + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B))

HabitatPhylo <- brm(Log10CFAR ~ Log10MeanGSH_centered + PrimaryHabitat + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B),
                    prior = HabitatPhylo_prior,
                sample_prior = TRUE, chains = 4, cores = 4)

summary(HabitatPhylo)
```

## Model 10 - CFAR ~ GSH * PrimaryHabitat + Phylogeny
```{r}
HabitatPhylo_prior2 <- get_prior(Log10CFAR ~ Log10MeanGSH_centered * PrimaryHabitat + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B))

HabitatPhylo2 <- brm(Log10CFAR ~ Log10MeanGSH_centered * PrimaryHabitat + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B),
                    prior = HabitatPhylo_prior2,
                sample_prior = TRUE, chains = 4, cores = 4)

summary(HabitatPhylo2)
```


## Model 11 - CFAR ~ GSH * MaxSize + PrimaryHabitat + Phylogeny
```{r}
SizeHabitatMod_prior <- get_prior(Log10CFAR ~ Log10MeanGSH_centered * Log10MaxSize_centered + PrimaryHabitat + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B))

SizeHabitatModel <- brm(Log10CFAR ~ Log10MeanGSH_centered * Log10MaxSize_centered + PrimaryHabitat + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B),
                    prior = SizeHabitatMod_prior,
                sample_prior = TRUE, chains = 4, cores = 4)

summary(SizeHabitatModel)
```
```{r}
plot(conditional_effects(SizeHabitatModel), points = TRUE)
```


##Model 12 -- CFAR ~ GSH * MaxSize * PrimaryHabitat + Phylogeny
```{r}
BRMS_12_prior <- get_prior(Log10CFAR ~ Log10MeanGSH_centered * Log10MaxSize_centered * PrimaryHabitat + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B))

BRMS_12_Model <- brm(Log10CFAR ~ Log10MeanGSH_centered * Log10MaxSize_centered * PrimaryHabitat + (1|gr(Binomial, cov = B)),
                    data = GSH_df_pgls,
                    family = gaussian(),
                    data2 = list(B = B),
                    prior = BRMS_12_prior,
                sample_prior = TRUE, chains = 4, cores = 4)

summary(BRMS_12_Model)
```

```{r}
plot(conditional_effects(BRMS_12_Model), points = TRUE)
```



##LOO comapre (quick and dirty version)

```{r}
fit1_loo <- loo(Model_plain)
fit2_loo <- loo(Model_size)
fit3_loo <- loo(Model_size_2)
fit4_loo <- loo(habitat_model)
fit5_loo <- loo(habitat_model_2)

brms_loo_nonphylo_list <- list(fit1_loo, fit2_loo, fit3_loo, fit4_loo, fit5_loo)
brms_loo_nonphylo <- loo_compare(brms_loo_nonphylo_list)
loo_model_weights(brms_loo_nonphylo_list)

fit6_loo <- loo(Model_simple, moment_match = TRUE, reloo = TRUE) #31, 74, 157, 183, 336, 451
fit7_loo <- loo(Model_BS)
fit8_loo <- loo(Model_BS2)
fit9_loo <- loo(HabitatPhylo)
fit10_loo <- loo(HabitatPhylo2)
fit11_loo <- loo(SizeHabitatModel)
fit12_loo <- loo(BRMS_12_Model)

brms_loo_phylo_list <- list(fit6_loo, fit7_loo, fit8_loo, fit9_loo, fit10_loo, fit11_loo, fit12_loo)
brms_loo_phylo <- loo_compare(brms_loo_phylo_list)
loo_model_weights(brms_loo_phylo_list)




```
